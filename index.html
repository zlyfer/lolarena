<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>LoL Arena</title>
		<style>
			:root {
				--bg-color: #f0f0f0;
				--card-bg: #ffffff;
				--text-color: #333;
				--border-color: #ddd;
				--button-bg: #f4f4f4;
				--button-hover: #e0e0e0;
				--primary-color: #0A7CFF;
			}

			[data-theme="dark"] {
				--bg-color: #222;
				--card-bg: #333;
				--text-color: #eee;
				--border-color: #444;
				--button-bg: #444;
				--button-hover: #555;
				--primary-color: #1A8CFF;
			}

			body {
				font-family: Arial, sans-serif;
				margin: 0;
				padding: 20px;
				background-color: var(--bg-color);
				color: var(--text-color);
				transition: background-color 0.3s, color 0.3s;
			}

			body:has(.login-container) {
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
				padding: 0;
			}

			.login-container {
				max-width: 400px;
				margin: 0 auto;
				padding: 20px;
				background-color: var(--card-bg);
				border-radius: 5px;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			}

			.champ-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
				gap: 15px;
				margin-top: 20px;
			}

			.champ-card {
				height: 250px;
				background-color: rgb(222, 222, 222);
				border-radius: 15px;
				border: 2px solid rgba(0, 0, 0, 0.1);
				padding: 15px;
				text-align: center;
				cursor: pointer;
				box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.12);
				transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
				background-size: calc(100% + 30px);
				background-position: top -15px left -15px;
				position: relative;
				display: flex;
				flex-direction: column;
				justify-content: flex-end;
				color: white;
				font-weight: bold;
				font-size: 18px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
				box-sizing: border-box;
				overflow: hidden;
			}

			.champ-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 12px 16px rgba(0, 0, 0, 0.2), 0 4px 6px rgba(0, 0, 0, 0.15);
			}

			.champ-card .overlay {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: transparent;
				transition: background-color 0.2s;
			}

			.champ-card.owned .overlay {
				background-color: rgba(0, 0, 0, 0.6);
			}

			.checkmark {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				font-size: 60px;
				color: #D4AF37;
				/* Golden color */
				opacity: 0;
				transition: opacity 0.2s;
				z-index: 3;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
			}

			.champ-card.owned .checkmark {
				opacity: 1;
			}

			/* Loading state styles */
			.champ-card.loading .overlay {
				background-color: rgba(0, 0, 0, 0.7);
			}

			.loading-spinner {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 50px;
				height: 50px;
				border: 5px solid rgba(255, 255, 255, 0.3);
				border-radius: 50%;
				border-top-color: #fff;
				opacity: 0;
				z-index: 3;
				animation: spin 1s ease-in-out infinite;
				display: none;
			}

			@keyframes spin {
				to {
					transform: translate(-50%, -50%) rotate(360deg);
				}
			}

			.champ-card.loading .loading-spinner {
				opacity: 1;
				display: block;
			}

			.champ-card.loading .checkmark {
				opacity: 0;
			}

			.champ-card .champ-name {
				position: relative;
				z-index: 2;
			}

			.header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
			}

			input[type="text"],
			input[type="password"],
			button {
				padding: 10px;
				margin: 5px 0;
				width: 100%;
				box-sizing: border-box;
			}

			button {
				background-color: #0A7CFF;
				color: white;
				border: none;
				cursor: pointer;
			}

			.error {
				color: red;
				margin-bottom: 10px;
			}

			/* Search and filter styles */
			.search-filter {
				margin-bottom: 20px;
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				align-items: center;
				justify-content: space-between;
			}

			.left-controls {
				display: flex;
				gap: 10px;
				align-items: center;
			}

			.right-controls {
				display: flex;
				gap: 10px;
				align-items: center;
			}

			.search-container {
				width: 300px;
				position: relative;
				display: flex;
			}

			.search-bar {
				width: 100%;
				padding: 10px 15px;
				border: 1px solid var(--border-color);
				border-radius: 4px;
				font-size: 16px;
				height: 42px;
				box-sizing: border-box;
				padding-right: 35px;
				background-color: var(--card-bg);
				color: var(--text-color);
			}

			.clear-search-btn {
				position: absolute;
				right: 10px;
				top: calc(50% - 5px);
				transform: translateY(-50%);
				border: none;
				font-size: 14px;
				cursor: pointer;
				padding: 5px 5px 7px 5px;
				display: flex;
				align-items: center;
				justify-content: center;
				width: 20px;
				height: 20px;
				border-radius: 5px;
				background-color: rgba(0, 0, 0, 0.05);
				color: #666;
			}

			.filter-buttons {
				display: flex;
				border-radius: 4px;
				overflow: hidden;
				height: 42px;
			}

			.filter-button {
				padding: 10px 20px;
				background-color: var(--card-bg);
				border: 1px solid var(--border-color);
				color: var(--text-color);
				cursor: pointer;
				margin: 0;
				width: auto;
				height: 42px;
				box-sizing: border-box;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.filter-button.active {
				background-color: #0A7CFF;
				color: white;
				border-color: #0A7CFF;
			}

			.filter-button:not(:last-child) {
				border-right: none;
			}

			.group-toggle-btn,
			.username-btn {
				padding: 10px 20px;
				background-color: var(--card-bg);
				border: 1px solid var(--border-color);
				color: var(--text-color);
				cursor: pointer;
				margin: 0;
				width: 200px;
				height: 42px;
				box-sizing: border-box;
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: 4px;
			}

			.username-btn {
				font-weight: bold;
				cursor: default;
				display: flex;
				align-items: center;
				gap: 15px;
			}

			.username-text {
				font-weight: bold;
			}

			.count-info {
				font-weight: normal;
			}

			.group-toggle-btn.active {
				background-color: #0A7CFF;
				color: white;
				border-color: #0A7CFF;
			}

			.group-heading {
				font-size: 20px;
				font-weight: bold;
				margin: 30px 0 15px 0;
				display: none;
			}

			/* Hide champions that don't match filter */
			.champ-card.filtered {
				display: none;
			}

			.header-actions {
				display: flex;
				align-items: center;
				gap: 15px;
			}

			.champ-counter {
				font-size: 16px;
				color: #333;
				padding: 10px 15px;
				background-color: #f0f0f0;
				border-radius: 4px;
				border: 1px solid #ddd;
			}

			.logout-btn {
				display: inline-block;
				padding: 10px 20px;
				background-color: var(--button-bg);
				color: var(--text-color);
				text-decoration: none;
				border-radius: 4px;
				border: 1px solid var(--border-color);
				font-size: 16px;
				height: 42px;
				box-sizing: border-box;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: background-color 0.2s;
				cursor: pointer;
			}

			.logout-btn:hover {
				background-color: var(--button-hover);
			}

			.theme-toggle-btn {
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 10px 15px;
				background-color: var(--button-bg);
				color: var(--text-color);
				border-radius: 4px;
				border: 1px solid var(--border-color);
				font-size: 16px;
				height: 42px;
				box-sizing: border-box;
				cursor: pointer;
				transition: background-color 0.2s;
			}

			.theme-toggle-btn:hover {
				background-color: var(--button-hover);
			}

		</style>
	</head>

	<body>
		<!-- Login Form (initially shown) -->
		<div id="login-form" class="login-container">
			<h2>LoL Arena Login</h2>
			<div id="login-error" class="error" style="display: none;"></div>
			<div id="login-form-element">
				<input type="text" id="username" name="username" placeholder="Username" required>
				<input type="password" id="password" name="password" placeholder="Password" required>
				<button type="button" id="login-button">Login</button>
			</div>
		</div>

		<!-- Champion Grid (initially hidden) -->
		<div id="champion-grid-container" style="display: none;">
			<div class="search-filter">
				<div class="left-controls">
					<div class="username-btn">
						<span id="username-display" class="username-text"></span>
						<span id="count-info" class="count-info"></span>
					</div>
					<div class="search-container">
						<input type="text" class="search-bar" placeholder="Search champions...">
						<button class="clear-search-btn">✕</button>
					</div>
					<div class="filter-buttons">
						<button class="filter-button active" data-filter="all">All</button>
						<button class="filter-button" data-filter="owned">Checked</button>
						<button class="filter-button" data-filter="unowned">Unchecked</button>
					</div>
				</div>
				<div class="right-controls">
					<button class="theme-toggle-btn" id="theme-toggle">Light</button>
					<button class="logout-btn" id="logout-btn">Logout</button>
				</div>
			</div>

			<div class="group-heading" id="checked-heading">Checked</div>
			<div class="champ-grid" id="checked-grid"></div>
			<div class="group-heading" id="unchecked-heading">Unchecked</div>
			<div class="champ-grid" id="unchecked-grid"></div>
			<div class="champ-grid" id="main-grid"></div>
		</div>

		<script>
			// API base URL - change this to your actual API URL
			const API_BASE_URL = 'https://api.zlyfer.net/lolarena';
			let currentUser = null;
			let champList = [];

			// DOM elements
			const loginForm = document.getElementById('login-form');
			const loginError = document.getElementById('login-error');
			const championGridContainer = document.getElementById('champion-grid-container');
			const usernameDisplay = document.getElementById('username-display');
			const countInfo = document.getElementById('count-info');
			const mainGrid = document.getElementById('main-grid');
			const logoutBtn = document.getElementById('logout-btn');
			const searchBar = document.querySelector('.search-bar');
			const clearSearchBtn = document.querySelector('.clear-search-btn');
			const filterButtons = document.querySelectorAll('.filter-button');
			const checkedGrid = document.getElementById('checked-grid');
			const uncheckedGrid = document.getElementById('unchecked-grid');
			const checkedHeading = document.getElementById('checked-heading');
			const uncheckedHeading = document.getElementById('unchecked-heading');
			const themeToggleBtn = document.getElementById('theme-toggle');

			// Theme variables - moved before initialization
			const THEMES = ['auto', 'light', 'dark'];
			let currentThemeIndex = 0;

			// Init - check if user is logged in from localStorage
			initializeApp();

			function initializeApp() {
				// Load user from localStorage if available
				const savedUser = localStorage.getItem('lolArenaUser');
				if (savedUser) {
					try {
						currentUser = JSON.parse(savedUser);
						fetchChampions();
					} catch (e) {
						console.error('Error parsing saved user', e);
						showLoginForm();
					}
				} else {
					showLoginForm();
				}

				// Initialize theme
				initTheme();
			}

			// Login with click event
			document.getElementById('login-button').addEventListener('click', function () {
				console.log(`${API_BASE_URL}/login`);
				const username = document.getElementById('username').value;
				const password = document.getElementById('password').value;

				// Validate inputs
				if (!username || !password) {
					loginError.textContent = 'Please enter both username and password';
					loginError.style.display = 'block';
					return;
				}


				fetch(`${API_BASE_URL}/login`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						username: username,
						password: password
					})
				})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						if (data.success) {
							currentUser = data.user;
							localStorage.setItem('lolArenaUser', JSON.stringify(currentUser));
							fetchChampions();
						} else {
							loginError.textContent = data.message || 'Login failed';
							loginError.style.display = 'block';
						}
					})
					.catch(error => {
						console.error('Error:', error);
						loginError.textContent = 'An error occurred. Please try again.';
						loginError.style.display = 'block';
					});
			});

			// Add keyboard event listeners for Enter key on login inputs
			document.getElementById('username').addEventListener('keyup', function (event) {
				if (event.key === 'Enter') {
					document.getElementById('login-button').click();
				}
			});

			document.getElementById('password').addEventListener('keyup', function (event) {
				if (event.key === 'Enter') {
					document.getElementById('login-button').click();
				}
			});

			// Logout button
			logoutBtn.addEventListener('click', function () {
				localStorage.removeItem('lolArenaUser');
				currentUser = null;
				showLoginForm();
			});

			// Fetch champions list
			function fetchChampions() {
				fetch(`${API_BASE_URL}/champions`)
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							champList = data.champions;
							renderChampionGrid();
							showChampionGrid();
						} else {
							console.error('Error fetching champions:', data.message);
							loginError.textContent = 'Error loading champions. Please try again.';
							loginError.style.display = 'block';
						}
					})
					.catch(error => {
						console.error('Error:', error);
						loginError.textContent = 'An error occurred. Please try again.';
						loginError.style.display = 'block';
					});
			}

			// Render champion grid
			function renderChampionGrid() {
				mainGrid.innerHTML = '';

				champList.forEach(champ => {
					const isOwned = currentUser.champs.includes(champ);

					// Special case handling for specific champions
					let bgChampName = champ;
					if (champ === 'Wukong') {
						bgChampName = 'MonkeyKing';
					} else if (champ === 'Renata Glasc') {
						bgChampName = 'Renata';
					} else if (champ === 'K\'Sante') {
						bgChampName = 'KSante';
					} else if (champ === 'Kog\'Maw') {
						bgChampName = 'KogMaw';
					} else if (champ === 'Rek\'Sai') {
						bgChampName = 'RekSai';
					} else if (champ === 'LeBlanc') {
						bgChampName = 'Leblanc';
					}

					// Process champion name for URL
					// 1. Replace apostrophes and make the next letter lowercase
					bgChampName = bgChampName.replace(/\'([A-Z])/g, (match, p1) => p1.toLowerCase());

					// 2. Remove any remaining spaces and periods
					bgChampName = bgChampName.replace(/[ .]/g, '');

					const card = document.createElement('div');
					card.className = `champ-card ${isOwned ? 'owned' : ''}`;
					card.dataset.champ = champ;
					card.style.backgroundImage = `url('http://ddragon.leagueoflegends.com/cdn/img/champion/loading/${bgChampName}_0.jpg')`;

					card.innerHTML = `
          <div class="overlay"></div>
          <div class="checkmark">✓</div>
          <div class="loading-spinner"></div>
          <div class="champ-name">${champ}</div>
        `;

					card.addEventListener('click', function () {
						toggleChampion(card, champ);
					});

					mainGrid.appendChild(card);
				});

				// Update user display
				usernameDisplay.textContent = currentUser.username;
				countInfo.textContent = `${currentUser.champs.length}/${champList.length}`;

				// Apply initial filters
				applyFilters();
			}

			// Toggle champion ownership
			function toggleChampion(card, champName) {
				// Don't allow clicking if already in loading state
				if (card.classList.contains('loading')) {
					return;
				}

				// Set loading state
				const wasOwned = card.classList.contains('owned');
				card.classList.remove('owned');
				card.classList.add('loading');

				fetch(`${API_BASE_URL}/toggle-champion`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
					},
					body: `userId=${currentUser.id}&championName=${encodeURIComponent(champName)}`
				})
					.then(response => response.json())
					.then(data => {
						// Remove loading state
						card.classList.remove('loading');

						if (data.success) {
							// Update currentUser.champs with the new list
							currentUser.champs = data.champions;
							localStorage.setItem('lolArenaUser', JSON.stringify(currentUser));

							// Toggle the owned class based on the new state
							if (wasOwned) {
								card.classList.remove('owned');
							} else {
								card.classList.add('owned');
							}

							// Update counter
							countInfo.textContent = `${currentUser.champs.length}/${champList.length}`;

							// Re-apply current filter after state change
							applyFilters();
						} else {
							console.error('Error toggling champion:', data.message);
							// Restore previous state
							if (wasOwned) {
								card.classList.add('owned');
							}
							alert('Error: ' + (data.message || 'Failed to update champion'));
						}
					})
					.catch(error => {
						console.error('Error:', error);
						// Remove loading state and restore previous state
						card.classList.remove('loading');
						if (wasOwned) {
							card.classList.add('owned');
						}
						alert('Request failed. Please check your connection.');
					});
			}

			/* ----- UI Functions ----- */

			function showLoginForm() {
				loginForm.style.display = 'block';
				championGridContainer.style.display = 'none';
				loginError.style.display = 'none';
				document.getElementById('username').value = '';
				document.getElementById('password').value = '';
			}

			function showChampionGrid() {
				loginForm.style.display = 'none';
				championGridContainer.style.display = 'block';
			}

			// Search and filter functionality
			let currentFilter = 'all';
			let isGrouped = false;

			// Filter buttons click handler
			filterButtons.forEach(button => {
				button.addEventListener('click', function () {
					// Update active button
					filterButtons.forEach(btn => btn.classList.remove('active'));
					this.classList.add('active');

					// Set current filter
					currentFilter = this.dataset.filter;

					// Apply filters
					applyFilters();
				});
			});

			// Search input handler
			searchBar.addEventListener('input', function () {
				applyFilters();
			});

			// Clear search button handler
			clearSearchBtn.addEventListener('click', function () {
				searchBar.value = '';
				applyFilters();
				searchBar.focus();
			});

			// Apply both search and ownership filters
			function applyFilters() {
				const searchTerm = searchBar.value.toLowerCase();

				document.querySelectorAll('.champ-card').forEach(card => {
					const champName = card.dataset.champ.toLowerCase();
					const isOwned = card.classList.contains('owned');
					let showBasedOnFilter = false;

					// Determine visibility based on filter type
					if (currentFilter === 'all' ||
						(currentFilter === 'owned' && isOwned) ||
						(currentFilter === 'unowned' && !isOwned)) {
						showBasedOnFilter = true;
					}

					// Determine visibility based on search term
					const matchesSearch = champName.includes(searchTerm);

					// Apply combined filter
					if (showBasedOnFilter && matchesSearch) {
						card.classList.remove('filtered');
					} else {
						card.classList.add('filtered');
					}
				});
			}

			// Theme toggle functionality
			themeToggleBtn.addEventListener('click', function () {
				currentThemeIndex = (currentThemeIndex + 1) % THEMES.length;
				const newTheme = THEMES[currentThemeIndex];
				localStorage.setItem('theme', newTheme);
				applyTheme(newTheme);
				updateThemeButtonText();
			});

			// Apply theme to document
			function applyTheme(theme) {
				if (theme === 'auto') {
					// Use system preference
					if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
						document.documentElement.setAttribute('data-theme', 'dark');
					} else {
						document.documentElement.setAttribute('data-theme', 'light');
					}

					// Listen for system theme changes
					window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
						if (localStorage.getItem('theme') === 'auto') {
							document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
						}
					});
				} else {
					document.documentElement.setAttribute('data-theme', theme);
				}
			}

			// Update button text based on current theme
			function updateThemeButtonText() {
				themeToggleBtn.textContent = THEMES[currentThemeIndex].charAt(0).toUpperCase() + THEMES[currentThemeIndex].slice(1);
			}

			// Initialize theme from localStorage or default to auto
			function initTheme() {
				const savedTheme = localStorage.getItem('theme') || 'auto';
				currentThemeIndex = THEMES.indexOf(savedTheme);
				if (currentThemeIndex === -1) currentThemeIndex = 0;
				applyTheme(THEMES[currentThemeIndex]);
				updateThemeButtonText();
			}
		</script>
	</body>

</html>
